<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/thymeleaf-extras-springsecurity6">

    <head th:replace="~{general/fragmentos :: head}"/>
    <body>
        
        <section th:fragment="agregar">
            <div class='row py-4 mb-2' style="background-color: #EDD9A3;">
                <div class='col-md-1'></div>
                <div class='col-md-3'>
                    <button type="button" class="btn text-white" style="background-color: #0A2239;" sec:authorize="hasRole('ROLE_ADMIN')"
                            data-bs-toggle="modal" data-bs-target="#agregarEjercicioModal">
                        <i class="fa-solid fa-plus"></i> [[#{ejercicio.agregar}]]
                    </button>
                </div>
            </div>
            
            <div class="modal fade" id="agregarEjercicioModal" tabindex="-1" aria-hidden="true">
                <div class="modal-dialog">
                    <div class="modal-content">
                        <div class="modal-header bg-info text-white">
                            <h1 class="modal-title fs-5">
                                <i class="fa-solid fa-dumbbell"></i> [[#{ejercicio.agregar}]]
                            </h1>
                            <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                        </div>
                        <form th:action="@{/ejercicios/guardar}" th:object="${ejercicio}"
                              method="post" class="was-validated">
                            <div class="modal-body">
                                <input type="hidden" th:field="*{id}" />

                                <div class="mb-3">
                                    <label>[[#{ejercicio.nombre}]]</label>
                                    <input type="text" th:field="*{nombre}" class="form-control" required="true">
                                </div>
                                <div class="mb-3">
                                    <label>[[#{ejercicio.duracionMinutos}]] (min)</label>
                                    <input type="number" th:field="*{duracionMinutos}" class="form-control" required="true">
                                </div>
                                <div class="mb-3">
                                    <label>[[#{libro.precio}]]</label>
                                    <input type="number" th:field="*{precio}" step="0.01" class="form-control" required="true">
                                </div>
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                                    <i class="fa-solid fa-xmark"></i> [[#{accion.cerrar}]]
                                </button>
                                <button type="submit" class="btn btn-primary">
                                    <i class="fa-solid fa-floppy-disk"></i> [[#{accion.guardar}]]
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </section>
        
        <section th:fragment="listado" class="p-3">
            <div class="row p-3">
                <div class="col-md-9">
                    <div class="card p-2">
                        <div class="card-header"><h4>[[#{menu.ejerciciosCardio}]]</h4></div>
                        <div class="card-body">
                            <div th:if="${ejercicios != null and !ejercicios.empty}">
                                <table class="table table-striped table-hover">
                                    <thead>
                                        <tr>
                                            <th>ID</th>
                                            <th>[[#{ejercicio.nombre}]]</th>
                                            <th>[[#{ejercicio.duracion}]]</th>
                                            <th>[[#{libro.precio}]]</th>
                                            <th>[[#{accion.acciones}]]</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr th:each="ejercicio : ${ejercicios}">
                                            <td th:text="${ejercicio.id}"></td>
                                            <td th:text="${ejercicio.nombre}"></td>
                                            <td th:text="${ejercicio.duracionMinutos}"></td>
                                            <td th:text="${ejercicio.precio}"></td>
                                            <td>
                                                <a th:href="@{/ejercicios/modificar/}+${ejercicio.id}" class="btn btn-warning btn-sm me-1">
                                                    <i class="fas fa-pencil-alt"></i> [[#{accion.actualizar}]]
                                                </a>
                                                <button type="button" class="btn btn-danger btn-sm"
                                                        data-bs-toggle="modal"
                                                        data-bs-target="#confirmModal"
                                                        th:data-bs-id="${ejercicio.id}"
                                                        th:data-bs-descripcion="${ejercicio.nombre}">
                                                    <i class="fa-solid fa-trash"></i> [[#{accion.eliminar}]]
                                                </button>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                            <div class="text-center p-2" th:if="${ejercicios == null or ejercicios.empty}">
                                <span>[[#{lista.vacia}]]</span>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="card text-center text-white mb-3" style="background-color:#625834;">
                        <div class="card-body">
                            <h3>[[#{ejercicio.total}]]</h3>
                            <h4 class="fs-2">
                                <i class="fa-solid fa-dumbbell"></i> [[${totalEjercicios}]]
                            </h4>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <section th:fragment="editar">
            <div class="row">
                <div class="col-md-2"></div>
                <div class="col-md-8">
                    <form method="POST" th:action="@{/ejercicios/guardar}"
                          th:object="${ejercicio}" class="was-validated">

                        <input type="hidden" th:field="*{id}"/>

                        <div class="row py-4 mb-4 bg-light">
                            <div class="col-md-4 d-grid">
                                <a th:href="@{/ejercicios/listado}" class="btn btn-primary">
                                    <i class="fas fa-arrow-left"></i> [[#{accion.regresar}]]
                                </a>
                            </div>
                            <div class="col-md-4 d-grid">
                                <button type="submit" class="btn btn-success">
                                    <i class="fas fa-check"></i> [[#{accion.guardar}]]
                                </button>
                            </div>
                        </div>

                        <div class="card">
                            <div class="card-header">
                                <h4>[[${ejercicio.id} == null ? #{ejercicio.crear} : #{ejercicio.modificar}]]</h4>
                            </div>
                            <div class="card-body">
                                <div class="mb-3">
                                    <label>[[#{ejercicio.nombre}]]</label>
                                    <input type="text" th:field="*{nombre}" class="form-control" required="true">
                                </div>
                                <div class="mb-3">
                                    <label>[[#{ejercicio.duracionMinutos}]] (min)</label>
                                    <input type="number" th:field="*{duracionMinutos}" class="form-control" required="true">
                                </div>
                                <div class="mb-3">
                                    <label>[[#{libro.precio}]]</label>
                                    <input type="number" th:field="*{precio}" step="0.01" class="form-control" required="true">
                                </div>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </section>
        
        <section th:fragment="confirmarEliminar">
            <div class="modal fade" id="confirmModal" tabindex="-1" aria-hidden="true">
                <div class="modal-dialog modal-dialog-centered">
                    <div class="modal-content">
                        <form th:action="@{/ejercicios/eliminar}" method="post">
                            <input type="hidden" name="id" id="modalId">
                            <div class="modal-header bg-warning text-white">
                                <h5 class="modal-title" id="modalLabel">
                                    <i class="fa-solid fa-circle-radiation"></i> [[#{accion.confirmar}]]
                                </h5>
                                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Cerrar"></button>
                            </div>
                            <div class="modal-body">
                                <p>[[#{accion.confirmar.texto1}]] <strong id="modalDescripcion"></strong>?</p>
                                <h6>[[#{accion.confirmar.texto2}]]</h6>
                            </div>
                            <div class="modal-footer">
                                <button type="submit" class="btn btn-danger">
                                    <i class="fa-solid fa-trash"></i> [[#{accion.eliminar}]]
                                </button>
                                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                                    <i class="fa-solid fa-xmark"></i> [[#{accion.cerrar}]]
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
            <script>
                document.addEventListener('DOMContentLoaded', function () {
                    var confirmModal = document.getElementById('confirmModal');
                    if (confirmModal) {
                        confirmModal.addEventListener('show.bs.modal', function (event) {
                            var button = event.relatedTarget;
                            var id = button.getAttribute('data-bs-id');
                            var descripcion = button.getAttribute('data-bs-descripcion');
                            
                            var modalIdInput = confirmModal.querySelector('#modalId');
                            var modalDescripcion = confirmModal.querySelector('#modalDescripcion');

                            modalIdInput.value = id;
                            modalDescripcion.textContent = descripcion;
                        });
                    }
                });
            </script>
        </section>
        
        </body>
</html>